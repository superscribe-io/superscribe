import{_ as s,c as e,o,R as a}from"./chunks/framework.70e71619.js";const h=JSON.parse('{"title":"Single Sign-On (SSO)","description":"Single Sign-On is a mechanism which allows to use external providers to login into systems.","frontmatter":{"description":"Single Sign-On is a mechanism which allows to use external providers to login into systems.","readTime":"4 min read"},"headers":[],"relativePath":"self-hosted/sso.md","lastUpdated":1682552691000}'),l={name:"self-hosted/sso.md"},n=a(`<h1 id="single-sign-on-sso" tabindex="-1">Single Sign-On (SSO) <a class="header-anchor" href="#single-sign-on-sso" aria-label="Permalink to &quot;Single Sign-On (SSO)&quot;">​</a></h1><p>Single Sign-On is a mechanism which allows to use external providers to login into systems. For example, you can use your Google or Facebook account to authenticate into systems without the need to create a new registration on those systems.</p><h2 id="supported-sso-mechanisms" tabindex="-1">Supported SSO mechanisms <a class="header-anchor" href="#supported-sso-mechanisms" aria-label="Permalink to &quot;Supported SSO mechanisms&quot;">​</a></h2><p>Directus supports four standard types of SSO mechanisms:</p><ul><li><a href="https://openid.net/specs/openid-connect-core-1_0.html" target="_blank" rel="noreferrer">OpenID</a></li><li><a href="https://www.ietf.org/rfc/rfc6750.txt" target="_blank" rel="noreferrer">OAuth 2.0</a></li><li><a href="https://datatracker.ietf.org/doc/html/rfc4511" target="_blank" rel="noreferrer">LDAP</a></li><li><a href="https://datatracker.ietf.org/doc/html/rfc7522" target="_blank" rel="noreferrer">SAML</a></li></ul><p>Here are the configuration allowed for each one: <a href="/self-hosted/config-options.html#sso-oauth2-and-openid">SSO configuration</a></p><p>In order to use these mechanisms you need to:</p><ol><li>Create an application/configuration on your preferred external provider</li><li>Set the environment variables to configure the external provider</li><li>[<em>Optional</em>] Set the environment variables to configure cookies</li></ol><h3 id="openid" tabindex="-1">OpenID <a class="header-anchor" href="#openid" aria-label="Permalink to &quot;OpenID&quot;">​</a></h3><p>In this section, we provide some guides to help you set up SSO with OpenID.</p><h4 id="google" tabindex="-1">Google <a class="header-anchor" href="#google" aria-label="Permalink to &quot;Google&quot;">​</a></h4><p>To be able to use Google OpenID as your external provider you will need to:</p><ol><li><p>Go into <a href="https://console.cloud.google.com" target="_blank" rel="noreferrer">Google Cloud Console</a></p></li><li><p>Select or Create a new project</p></li><li><p>Go to <a href="https://console.cloud.google.com/apis/credentials/consent" target="_blank" rel="noreferrer">APIs &amp; Services -&gt; OAuth consent screen</a> on side bar</p><ol><li>Select the access you desire <ul><li>Select <strong>Internal</strong> if you only want people within your organization to be able to access</li><li>Select <strong>External</strong> to allow everyone with a Google account</li></ul></li><li>Fill the fields according to your preferences <ul><li>The <strong>Authorized domains</strong> add an extra layer of security, but it is not required. In case you fill it, should be the domain where your Directus instance is</li></ul></li><li>On Scopes, you need to choose <code>.../auth/userinfo.email</code>, <code>.../auth/userinfo.profile</code> and <code>openid</code></li></ol></li><li><p>On side bar, go to <a href="https://console.cloud.google.com/apis/credentials" target="_blank" rel="noreferrer">Credentials</a></p></li><li><p>Click on <a href="https://console.cloud.google.com/apis/credentials/oauthclient" target="_blank" rel="noreferrer">Create Credentials -&gt; OAuth Client ID</a></p><ol><li>Choose <code>Web Application</code> on <strong>Application Type</strong></li><li>The <strong>Authorized JavaScript origins</strong> adds an extra layer of security, but it is not required. In case you fill it, should be the address of your Directus instance. For example, <code>https://directus.myserver.com</code></li><li>On <strong>Authorized redirect URIs</strong> put your Directus instance address plus <code>/auth/login/google/callback</code>. For example, you should put <code>https://directus.myserver.com/auth/login/google/callback</code> where <code>https://directus.myserver.com</code> should be the address of your Directus instance. If you are testing locally you should add <code>http://localhost:8055/auth/login/google/callback</code> too</li></ol></li><li><p>On click <strong>Create</strong>, a modal will appear with <strong>Client ID</strong> and <strong>Client Secret</strong>. Save both somewhere to use later.</p></li><li><p>Now on Directus side, you need to add the following configuration to your <code>.env</code> file located on root folder of your project:</p></li></ol><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">AUTH_PROVIDERS</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">google</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">AUTH_GOOGLE_DRIVER</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">openid</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">AUTH_GOOGLE_CLIENT_ID</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">XXXX</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># Replace XXXX with the Client ID from Step 6</span></span>
<span class="line"><span style="color:#A6ACCD;">AUTH_GOOGLE_CLIENT_SECRET</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">XXXX</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># Replace XXXX with the Client Secret from Step 6</span></span>
<span class="line"><span style="color:#A6ACCD;">AUTH_GOOGLE_ISSUER_URL</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://accounts.google.com</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">AUTH_GOOGLE_IDENTIFIER_KEY</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">email</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">AUTH_GOOGLE_ICON</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">google</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">AUTH_GOOGLE_LABEL</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Google</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">AUTH_GOOGLE_ALLOW_PUBLIC_REGISTRATION</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">true</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># This allows users to be automatically created on logins. Use &quot;false&quot; if you want to create users manually</span></span>
<span class="line"><span style="color:#A6ACCD;">AUTH_GOOGLE_DEFAULT_ROLE_ID</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># Replace this with the Directus Role ID you would want for new users. If this is not properly configured, new users will not have access to Directus</span></span></code></pre></div><ol start="8"><li>Now you can see a nice functional <code>Login with Google</code> button on Directus login page.</li></ol><h2 id="seamless-sso" tabindex="-1">Seamless SSO <a class="header-anchor" href="#seamless-sso" aria-label="Permalink to &quot;Seamless SSO&quot;">​</a></h2><p>While sometimes you want your users to directly have access to the Directus Application, in other cases you may need to fetch private data from Directus in your client using external providers. In this cases, it is needed a special configuration to work across domains, but is simple as:</p><ol><li>Setup an external provider. You have some examples on <a href="#supported-sso-mechanisms">Supported SSO mechanisms</a></li><li>Allow cookie to be accessible across domains. Put the following configuration on <code>.env</code>:</li></ol><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">REFRESH_TOKEN_COOKIE_DOMAIN</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">XXXX</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># Replace XXXX with the domain of your Directus instance. For example &quot;directus.myserver.com&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">REFRESH_TOKEN_COOKIE_SECURE</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">true</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">REFRESH_TOKEN_COOKIE_SAME_SITE</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">None</span><span style="color:#89DDFF;">&quot;</span></span></code></pre></div><ol start="2"><li>On your client, your login button should be something like</li></ol><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">a</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">href</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://directus.myserver.com/auth/login/google?redirect=https://client.myserver.com/login</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">Login</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">a</span><span style="color:#89DDFF;">&gt;</span></span></code></pre></div><ul><li>Where <code>https://directus.myserver.com</code> should be the address of your Directus instance</li><li>While <code>https://client.myserver.com/login</code> should be the address of your client application. The <code>/login</code> is not necessary, but helps to separate concerns</li></ul><ol start="3"><li><p>On your login page, following the example should be <code>https://client.myserver.com/login</code> you need to call the refresh endpoint either via REST API or via SDK in order to retrieve an <code>access_token</code></p><ul><li><p>via REST API / fetch</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">fetch</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://directus.myserver.com/auth/refresh</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F07178;">method</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">POST</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F07178;">credentials</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">include</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// this is required in order to send the refresh token cookie</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div></li><li><p>via SDK</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> sdk </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Directus</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://directus.myserver.com</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> sdk</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">auth</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">refresh</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span></code></pre></div></li></ul></li></ol><h3 id="testing-seamless-sso-locally" tabindex="-1">Testing Seamless SSO locally <a class="header-anchor" href="#testing-seamless-sso-locally" aria-label="Permalink to &quot;Testing Seamless SSO locally&quot;">​</a></h3><p>The above <code>REFRESH_TOKEN_*</code> configuration will likely fail for local testing, as you&#39;ll likely won&#39;t be serving Directus using a valid SSL certificate which are required for &quot;Secure&quot; cookies. Instead, for local testing purposes (<strong>and local testing purposes only</strong>), the following configuration can be used:</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">REFRESH_TOKEN_COOKIE_SECURE</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">false</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">REFRESH_TOKEN_COOKIE_SAME_SITE</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">lax</span><span style="color:#89DDFF;">&quot;</span></span></code></pre></div><p>Note that no <code>REFRESH_TOKEN_COOKIE_DOMAIN</code> value is set.</p><div class="warning custom-block"><p class="custom-block-title">Disabling secured cookies</p><p>The configuration disable secured cookies and should only be used in local environment. Using it in production exposes your instance to CSRF attacks.</p></div>`,28),t=[n];function r(p,c,i,u,D,y){return o(),e("div",null,t)}const F=s(l,[["render",r]]);export{h as __pageData,F as default};
