import{_ as a,c as s,o as e,R as o}from"./chunks/framework.70e71619.js";const C=JSON.parse('{"title":"Command Line Interface","description":"Directus has two command line interfaces (CLI) that you can use for various actions, one for server-side actions and another to interact with a Directus instance as you would with an SDK","frontmatter":{"description":"Directus has two command line interfaces (CLI) that you can use for various actions, one for server-side actions and another to interact with a Directus instance as you would with an SDK","readTime":"7 min read"},"headers":[],"relativePath":"self-hosted/cli.md","lastUpdated":1682552691000}'),t={name:"self-hosted/cli.md"},n=o(`<h1 id="command-line-interface" tabindex="-1">Command Line Interface <a class="header-anchor" href="#command-line-interface" aria-label="Permalink to &quot;Command Line Interface&quot;">​</a></h1><blockquote><p>Directus has two command line interfaces (CLI) that you can use for various actions. One is used for server-side actions that relate to your on-prem instance, like migrating the database or resetting a user, while the other allows you to interact with a Directus instance as you would with an SDK.</p></blockquote><h2 id="requirements" tabindex="-1">Requirements <a class="header-anchor" href="#requirements" aria-label="Permalink to &quot;Requirements&quot;">​</a></h2><ul><li>Node.js <a href="https://nodejs.dev/en/about/releases/" target="_blank" rel="noreferrer">Active LTS</a></li></ul><h2 id="server" tabindex="-1">Server <a class="header-anchor" href="#server" aria-label="Permalink to &quot;Server&quot;">​</a></h2><p>For server-side CLI, all functionality can be accessed by running <code>npx directus &lt;command&gt;</code> in your project folder.</p><h3 id="initialize-a-new-project" tabindex="-1">Initialize a New Project <a class="header-anchor" href="#initialize-a-new-project" aria-label="Permalink to &quot;Initialize a New Project&quot;">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">directus</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">init</span></span></code></pre></div><p>Will install the required database driver, and create a <code>.env</code> file based on the inputted values.</p><h3 id="bootstrap-a-project" tabindex="-1">Bootstrap a Project <a class="header-anchor" href="#bootstrap-a-project" aria-label="Permalink to &quot;Bootstrap a Project&quot;">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">directus</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">bootstrap</span></span></code></pre></div><p>Will use an existing <code>.env</code> file (or existing environment variables) to either install the database (if it&#39;s empty) or migrate it to the latest version (if it already exists and has missing migrations).</p><p>This is very useful to use in environments where you&#39;re doing standalone automatic deployments, like a multi-container Kubernetes configuration.</p><div class="tip custom-block"><p class="custom-block-title">First User</p><p>You can use the <code>ADMIN_EMAIL</code> and <code>ADMIN_PASSWORD</code> environment variables to automatically provision the first user on first creation using the <code>bootstrap</code> command. See <a href="/self-hosted/config-options.html#general">Environment Variables</a> for more information.</p></div><div class="tip custom-block"><p class="custom-block-title">Skip Admin User/Role</p><p>You can pass the <code>--skipAdminInit</code> option to <code>bootstrap</code>, if you&#39;re creating your Admin role/user in another way (with a custom migration or an external service, for example).</p></div><h3 id="install-the-database" tabindex="-1">Install the Database <a class="header-anchor" href="#install-the-database" aria-label="Permalink to &quot;Install the Database&quot;">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">directus</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">database</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span></span></code></pre></div><p>Installs the initial Directus system tables on an empty database. Used internally by <code>bootstrap</code>.</p><p>It should be used only in specific cases, e.g. when you want to run something between <code>install</code> and <code>migrate</code>. You probably should call <code>directus database migrate:latest</code> afterwards manually.</p><p>You may want to use <code>directus bootstrap</code> instead.</p><h3 id="upgrade-the-database" tabindex="-1">Upgrade the Database <a class="header-anchor" href="#upgrade-the-database" aria-label="Permalink to &quot;Upgrade the Database&quot;">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">directus</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">database</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">migrate:latest</span></span>
<span class="line"><span style="color:#FFCB6B;">npx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">directus</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">database</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">migrate:up</span></span>
<span class="line"><span style="color:#FFCB6B;">npx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">directus</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">database</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">migrate:down</span></span></code></pre></div><p>Migrate the database up/down to match the versions of Directus. Once you update Directus itself, make sure to run <code>npx directus database migrate:latest</code> (or <code>npx directus bootstrap</code>) to update your database.</p><h3 id="migrate-schema-to-a-different-environment" tabindex="-1">Migrate Schema to a different Environment <a class="header-anchor" href="#migrate-schema-to-a-different-environment" aria-label="Permalink to &quot;Migrate Schema to a different Environment&quot;">​</a></h3><p>This allows you to do things like migrate a schema from development to production. To move your configured data model between Directus instances, you can use the schema &quot;snapshot&quot; and &quot;apply&quot; commands.</p><h4 id="snapshot-the-data-model" tabindex="-1">Snapshot the Data Model <a class="header-anchor" href="#snapshot-the-data-model" aria-label="Permalink to &quot;Snapshot the Data Model&quot;">​</a></h4><p>Directus can automatically generate a snapshot of your current data model in YAML or JSON format. This includes all collections, fields, and relations, and their configuration. This snapshot can be checked in version control and shared with your team. To generate the snapshot, run</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">directus</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">schema</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">snapshot</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./snapshot.yaml</span></span></code></pre></div><p>To run non-interactively (e.g. when running in a CI/CD workflow), run</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">directus</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">schema</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">snapshot</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--yes</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./snapshot.yaml</span></span></code></pre></div><p>Note, that this will force overwrite existing snapshot files.</p><div class="tip custom-block"><p class="custom-block-title">Date-based snapshots</p><p>To keep multiple snapshot organized by date, create a folder <code>snapshots</code> in your project root directory add the following custom script to your <code>package.json</code>:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">create-snapshot</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">npx directus schema snapshot ./snapshots/</span><span style="color:#A6ACCD;">\\&quot;</span><span style="color:#89DDFF;">$(</span><span style="color:#FFCB6B;">date</span><span style="color:#C3E88D;"> </span><span style="color:#A6ACCD;">\\&quot;</span><span style="color:#C3E88D;">+%F</span><span style="color:#A6ACCD;">\\&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">\\&quot;</span><span style="color:#C3E88D;">-snapshot-</span><span style="color:#A6ACCD;">\\&quot;</span><span style="color:#89DDFF;">$(</span><span style="color:#FFCB6B;">date</span><span style="color:#C3E88D;"> </span><span style="color:#A6ACCD;">\\&quot;</span><span style="color:#C3E88D;">+%s</span><span style="color:#A6ACCD;">\\&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">\\&quot;</span><span style="color:#C3E88D;">.yaml</span><span style="color:#89DDFF;">&quot;</span></span></code></pre></div><p>When you run the command via <code>npm run create-snapshot</code> it will create a new snapshot with the following naming schema: <code>[YYYY-MM-DD]-snapshot-[timestamp].yaml</code>. This command can be run e.g by your deployment pipeline before each deploy on your server to keep a schema backup.</p></div><h4 id="applying-a-snapshot" tabindex="-1">Applying a Snapshot <a class="header-anchor" href="#applying-a-snapshot" aria-label="Permalink to &quot;Applying a Snapshot&quot;">​</a></h4><p>To make a different instance up to date with the latest changes in your data model, you can apply the snapshot. By applying the snapshot, Directus will auto-detect the changes required to make the current instance up to date with the proposed data model in the snapshot file, and will run the required migrations to the database to make it match the snapshot.</p><p>To apply the generated snapshot, run</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">directus</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">schema</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">apply</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./path/to/snapshot.yaml</span></span></code></pre></div><p>To run non-interactively (e.g. when running in a CI/CD workflow), run</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">directus</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">schema</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">apply</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--yes</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./path/to/snapshot.yaml</span></span></code></pre></div><p>To diff the schema and database and print out the planned changes, run</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">directus</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">schema</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">apply</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--dry-run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./path/to/snapshot.yaml</span></span></code></pre></div><h3 id="creating-users" tabindex="-1">Creating Users <a class="header-anchor" href="#creating-users" aria-label="Permalink to &quot;Creating Users&quot;">​</a></h3><p>To create a new user with a specific role, run</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">directus</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">users</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">create</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--email</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">user-emai</span><span style="color:#A6ACCD;">l</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--password</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">passwor</span><span style="color:#A6ACCD;">d</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--role</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">role-uui</span><span style="color:#A6ACCD;">d</span><span style="color:#89DDFF;">&gt;</span></span></code></pre></div><h4 id="updating-user-password" tabindex="-1">Updating User Password <a class="header-anchor" href="#updating-user-password" aria-label="Permalink to &quot;Updating User Password&quot;">​</a></h4><p>To update the password of an existing user, run</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">directus</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">users</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">passwd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--email</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">user-emai</span><span style="color:#A6ACCD;">l</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--password</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">new-passwor</span><span style="color:#A6ACCD;">d</span><span style="color:#89DDFF;">&gt;</span></span></code></pre></div><h3 id="creating-roles" tabindex="-1">Creating Roles <a class="header-anchor" href="#creating-roles" aria-label="Permalink to &quot;Creating Roles&quot;">​</a></h3><p>To create a new role, run</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">directus</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">roles</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">create</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--role</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">role-nam</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">&gt;</span></span></code></pre></div><p>These roles are created with the <a href="/configuration/users-roles-permissions.html#configure-system-permissions">minimum permissions required</a> to properly access the App by default.</p><p>To create a new role with admin access, set the <code>--admin</code> flag to <code>true</code>, such as</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">directus</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">roles</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">create</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--role</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">role-nam</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--admin</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">true</span></span></code></pre></div><h3 id="count-items-in-a-collection" tabindex="-1">Count Items in a Collection <a class="header-anchor" href="#count-items-in-a-collection" aria-label="Permalink to &quot;Count Items in a Collection&quot;">​</a></h3><p>To count the amount of items in a given collection, run</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">directus</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">count</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">collection-nam</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">&gt;</span></span></code></pre></div><hr><h2 id="client" tabindex="-1">Client <a class="header-anchor" href="#client" aria-label="Permalink to &quot;Client&quot;">​</a></h2><p>For the client-side CLI, all functionality can be accessed by running <code>npx directusctl &lt;command&gt;</code>. You can also install <code>@directus/cli</code> on your project dependencies or globally on your machine. Note that if you run <code>directusctl</code> (installed globally) in a folder containing a project that has a version of <code>@directus/cli</code> installed, the running global CLI will forward it&#39;s execution to the local installed version instead.</p><h3 id="help-documentation" tabindex="-1">Help &amp; Documentation <a class="header-anchor" href="#help-documentation" aria-label="Permalink to &quot;Help &amp; Documentation&quot;">​</a></h3><p>The documentation for all commands can be accessed through the CLI itself. You can list all the available commands through <code>directusctl --help</code> command. If you want help for a specific command you can use <code>directusctl &lt;command&gt; --help</code> instead.</p><h3 id="instances" tabindex="-1">Instances <a class="header-anchor" href="#instances" aria-label="Permalink to &quot;Instances&quot;">​</a></h3><p>Most client-side CLI commands needs a running Directus instance in order to work. To connect the CLI to an instance, you can use <code>directusctl instance connect</code> command. These instance&#39;s configs are going to be saved on <code>~/.directus</code> folder.</p><p>To manage the connected instances, you can use <code>directusctl instance &lt;command&gt;</code> commands.</p><h4 id="selecting-instances" tabindex="-1">Selecting instances <a class="header-anchor" href="#selecting-instances" aria-label="Permalink to &quot;Selecting instances&quot;">​</a></h4><p>By default, commands will try using an instance named <code>default</code> when executing commands.</p><p>If you want to change which instance you want to use, either pass <code>--instance &lt;name&gt;</code> to the command, or configure <code>instance</code> variable on your project&#39;s Directus config file.</p><p>For example:</p><blockquote><p>.directus.yml</p></blockquote><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">instance</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">my-project</span></span></code></pre></div><h3 id="i-o" tabindex="-1">I/O <a class="header-anchor" href="#i-o" aria-label="Permalink to &quot;I/O&quot;">​</a></h3><p>The CLI is designed with ease of use and automation in mind, this means that you can change the way the output is made by setting how you want the data to be written to the terminal. We currently support three formats, <code>table</code> (the default one), <code>json</code> and <code>yaml</code>.</p><p>This makes it easier to parse and use data from Directus with other tools like <code>jq</code>, <code>yq</code>, <code>grep</code> or any other tools that accepts data from <code>stdin</code></p><p>It&#39;s also worth mentioning that everything is data. Try for example running <code>directusctl --help --format=json</code>.</p><h4 id="table" tabindex="-1">Table <a class="header-anchor" href="#table" aria-label="Permalink to &quot;Table&quot;">​</a></h4><p>The default output format. This is the &quot;pretty&quot; output, you&#39;ll most likely want to use this if you&#39;re not dealing with data in a way you need to pipe it to another command and/or store it for parsing.</p><p>This output will output colors and highlight content if it detects you&#39;re running in TTL.</p><h4 id="json" tabindex="-1">JSON <a class="header-anchor" href="#json" aria-label="Permalink to &quot;JSON&quot;">​</a></h4><p>This format will output JSON notation strings to your terminal. By default if TTY is detected, it will highlight (can be turned off with special flags) and prettify the output to make it easier to read.</p><p>Useful when you need to parse data using tools like <code>jq</code> for example.</p><h4 id="yaml" tabindex="-1">YAML <a class="header-anchor" href="#yaml" aria-label="Permalink to &quot;YAML&quot;">​</a></h4><p>This format will output YAML strings to your terminal. By default if TTY is detected, it will highlight (can be turned off with special flags) and prettify the output to make it easier to read.</p><p>Useful when you need to parse data using tools like <code>jq</code> for example.</p>`,82),l=[n];function p(r,c,i,d,h,u){return e(),s("div",null,l)}const m=a(t,[["render",p]]);export{C as __pageData,m as default};
